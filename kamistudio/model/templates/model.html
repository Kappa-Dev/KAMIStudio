{% extends "model_base.html" %}


{% block panel_buttons %}
<div class="row">
  <div class="col-md-4">
    <h2 class="mb-6 model-action-brand">{{ model.annotation.name }}</h2>
  </div>
  <div class="col-md-8">
    <div class="model-action-buttons">
        <a href="{{ url_for('model.add_interaction', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-plus"></span> Add interaction</a>
        <a href="{{ url_for('model.import_json_interactions', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-import"></span> Import interactions</a>
        <a href="{{ url_for('model.download_model', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-download-alt"></span> Export</a>
        <a href="{{ url_for('model.delete_model', model_id=model_id) }}" type="button" class="btn btn-primary btn-md panel-button instantiation"><span class="glyphicon glyphicon-remove"></span> Delete</a>
    </div>
  </div>
</div>

{% endblock %}

{% block sidebar_items %}
<h2 class="mb-6 model-action-brand">Model overview</h2>
<div class="highlighted-item instance" id="modelData">
    <!-- <h3 class="info-brand">Meta-data</h3>
    <div class="table-responsive">
      <table class="table info">
        <tbody>
          <tr>
            <th scope="row">Name</th>
            <td>{{ model.annotation.name }}</td>
          </tr>
          <tr>
            <th scope="row">Description</th>
            <td>{{ model.annotation.desc }}</td>
          </tr>
          <tr>
            <th scope="row">Organism</th>
            <td>{{ model.annotation.organism }}</td>
          </tr>
          <tr>
            <th scope="row">Created</th>
            <td>{{ model.creation_time }}</td>
          </tr>
          <tr>
            <th scope="row">Last modified</th>
            <td>{{ model.last_modified }}</td>
          </tr>
        </tbody>
      </table> 
    </div> -->
    
    <!-- <hr class="sidebar-model-sep"/> -->

    <!-- <h3 class="info-brand">Origin</h3>
    <div class="table-responsive">
      <table class="table info">
        <tbody>
          <tr>
            <th scope="row">Corpus </th>
            <td>
              {% if corpus %}
                <b><a class="instantiation-link" href="{{ url_for('corpus.corpus_view', corpus_id=corpus._id) }}">{{ corpus.annotation.name }}</a></b>
              {% else %}
                <p>No corpus associated</p>
              {% endif %}
            </td>
          </tr>
          <tr>
            {% if model._seed_genes %}
              <th scope="row" colspan="2"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Seed genes ({{ model._seed_genes|length }})</th>
            {% else %}
              <th scope="row" colspan="2"><p>No seed genes</p></th>
            {% endif %}
          </tr>
          <tr>
            {% if model._definitions %}
              <th scope="row" colspan="2"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Definitions ({{ model._definitions|length }})</th>
            {% else %}
              <th scope="row" colspan="2"><p>No protein definitions</p></th>
            {% endif %}
          </tr>
        </tbody>
      </table> 
    </div> -->
    
    <!-- <hr class="sidebar-model-sep"/> -->

<!--     <h3 class="info-brand">Interactions</h3>
    <div class="table-responsive">
      <table class="table info">
        <tbody>
          <tr>
            <th scope="row"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Proteins ({{ model.proteins()|length }})</th>
          </tr>
          <tr>
            <th scope="row"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Modifications ({{ model.modifications()|length}})</th>
          </tr>
          <tr>
            <th scope="row"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Bindings ({{ model.modifications()|length}})</th>
          </tr>
        </tbody>
      </table> 
    </div> -->

</div>


{% endblock %}

{% block tabs %}


    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item active">
        <a class="nav-link active instantiation-link" data-toggle="tab" href="#action_graph" role="tab">Action graph ({% if model.empty() %}empty{% else %}{{ model.action_graph.nodes()|length }} nodes {% endif %})</a>
      </li>
      <li class="nav-item">
        <a class="nav-link instantiation-link" data-toggle="tab" href="#nuggets" role="tab">Nuggets ({% if model.empty() %}0{% else %}{{ model.nuggets()|length }}{% endif %} nuggets)</a>
      </li>
    </ul>

    <!----------------- Tab panes ----------------------->
    <div class="tab-content">

      <!--------------- Action graph pane ----------------->

      <div class="tab-pane active" id="action_graph" role="tabpanel">
        {% if model.empty() %}
          Action graph is empty
        {% else %}
          <div class="row"> 
            <div class="col-md-9">
              <div class="action-graph-view">
                <a type="button" class="btn btn-default btn-md panel-button nugget-table-view active"><span class="glyphicon glyphicon-resize-full"></span> Action graph</a>
                <a type="button" class="btn btn-default btn-md panel-button nugget-list-view"><span class="glyphicon glyphicon-resize-small"></span> Interaction network</a>
                <a type="button" class="btn btn-default btn-md panel-button nugget-list-view"><span class="glyphicon glyphicon-record"></span> Chord diagram</a>
                <button id="saveLayoutButton" type="button" class="btn btn-primary btn-md panel-button nugget-list-view instantiation" style="float: right;" disabled><span class="glyphicon glyphicon-floppy-disk"></span> Save current layout</button>
              </div>

              <div id="progressBlock">
                <div id="progressMessage">Retrieving action graph from the database... It make take a moment.</div>
                <div id="loadingBlock" class="loading-elements center-block">
                  <div id="loaderModel"></div>
                </div>
              </div>


              <svg id="actionGraphSvg" style="width: 100%; height: 600px; display: none;"></svg>
            </div>
            <div class="col-md-3">
              <div id="graphInfoBoxes">
              </div>
            </div>
          </div>
        {% endif %}
      </div>

      <!------- End of action graph pane ------>

      <!------- Nuggets pane ------>

      <div class="tab-pane" id="nuggets" role="tabpanel">
        {% if model.empty() %}
            model does not contain any nuggets
        {% else %}
            <div class="row">
              <!-- Nugget list column -->
              <div class="col-sm-6">
                <div class="row">
                  <div class="col-sm-6">
                    <h3>Nuggets</h3>
                  </div>
                  <div class="col-sm-6">
                    <div class="nuggets-view">
                      <a type="button" class="btn btn-default btn-md panel-button nugget-list-view active"><span class="glyphicon glyphicon-list"></span> List view</a>
                      <a type="button" class="btn btn-default btn-md panel-button nugget-table-view" onclick="creatNuggetTable('{{ corpus_id }}')"><span class="glyphicon glyphicon-equalizer"></span> Table view</a>
                    </div>
                  </div>
                </div>
                <div id="nuggetsView">
                  <div id="nuggetsViewTable" class="table-responsive">
                    <table class="table table-striped table-sm">
                      <tbody>
                        {% for nugget in model.nuggets() %}
                        <tr>
                          <td class="nugget-record nugget-id"><a href="{{ url_for('nuggets.corpus_nugget_view', corpus_id=corpus_id, nugget_id=nugget) }}" class="instantiation-link">{{ nugget }}</a></td>
                          <td class="nugget-record nugget-desc"><p>{{ nugget_desc[nugget] }}</p></td>
                          <td class="nugget-nav-buttons">
                            <a type="button" id="showNuggetButton{{ nugget }}" class="btn btn-primary btn-md panel-button show-nugget-button instantiation" onclick="addSvgAndVisualizeNugget(this,  '{{ model_id }}', '{{ nugget }}', true)"><span class="glyphicon glyphicon-zoom-in"></span> View</a>
                            <a type="button" id="hideNuggetButton{{ nugget }}" class="btn btn-primary btn-md panel-button show-nugget-button instantiation" onclick="removeNuggetSvg(this, '{{ nugget }}')" style='display: none;'><span class="glyphicon glyphicon-remove"></span> Hide graph</a>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- End of nugget list column -->
              <!-- Nugget preview column -->
              <div class="col-sm-6">
                <div class="row">
                  <div class="col-sm-6">
                    <h3 style="margin-top: 0px;">Nugget view</h3>
                  </div>
                  <div class="col-sm-6">
                    
                  </div>
                </div>
                <p>Select a nugget to view</p>
              </div>
              <!-- End of nugget preview column -->          
            </div>
        {% endif %}
      </div>
  
      <!------- End of nuggets pane ------>

    </div>



{% endblock %}
{% if model.empty() %}
{% else %}
{% block custom_scripts %}
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="{{ url_for('static', filename='js/graphUtils.js') }}" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='js/info_boxes/InfoBox.jsx') }}" type="text/babel"></script>
  <script type="text/babel">
    getActionGraphAndVisualize('{{ model_id }}', '{{ url_for('static', filename='js/graph_visualisation/forceLayoutWorker.js')}}', true);
  </script>
  <script type="text/babel">
    ReactDOM.render(
      [<ElementInfoBox id="graphElement" items={[]}/>,
       <MetaDataBox id="metaData" items={[]}/>],
      document.getElementById('graphInfoBoxes')
    );
    ReactDOM.render(
      [<ModelDataBox 
          kbName='{{model.annotation.name}}'
          desc='{{model.annotation.desc}}'
          organism='{{model.annotation.organism}}'
          creation_time='{{model.creation_time}}'
          last_modified='{{model.last_modified}}'
          corpusId='{{corpus._id}}'
          corpusName='{{corpus.annotation.name}}'
          corpusUrl='{{url_for('corpus.corpus_view', corpus_id=corpus._id)}}'
          seedGenes='{{ model._seed_genes }}'
          definitions='{{ model._definitions }}'
         />],
      document.getElementById('modelData')
    );
  </script>
  <script src="{{ url_for('static', filename='js/nuggetTableView.js') }}" type="text/javascript"></script>

{% endblock %}
{% endif %}
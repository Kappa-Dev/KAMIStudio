{% extends "model_base.html" %}


{% block panel_buttons %}
<div class="row">
  <div class="col-md-4">
    <h1 class="mb-6 model-action-brand">Model overview</h1>
  </div>
  <div class="col-md-8">
    <div class="model-action-buttons">
      <a href="{{ url_for('model.add_interaction', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-plus"></span> Add interaction</a>
      <a href="{{ url_for('model.import_json_interactions', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-import"></span> Import interactions</a>
      <a href="{{ url_for('model.download_model', model_id=model_id) }}" type="button" class="btn btn-default btn-md panel-button add-interaction-button"><span class="glyphicon glyphicon-download-alt"></span> Download model</a>
    </div>
  </div>
</div>
{% endblock %}

{% block sidebar_items %}
<!--   <div class="side-bar-tools">
    <h3 id="browsing">Tools</h3>
  </div> -->
{% endblock %}

{% block tabs %}

<!--     <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" href="#">
          Action graph ({% if models[model_id].empty() %}empty{% else %}{{ models[model_id].action_graph.nodes()|length }} nodes {% endif %})
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Nuggets ({% if models[model_id].empty() %}0{% else %}{{ models[model_id].nuggets()|length }}{% endif %} nuggets)</a>
      </li>
    </ul> -->

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item active">
        <a class="nav-link active" data-toggle="tab" href="#action_graph" role="tab">Action graph ({% if models[model_id].empty() %}empty{% else %}{{ models[model_id].action_graph.nodes()|length }} nodes {% endif %})</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#nuggets" role="tab">Nuggets ({% if models[model_id].empty() %}0{% else %}{{ models[model_id].nuggets()|length }}{% endif %} nuggets)</a>
      </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" id="action_graph" role="tabpanel">
        {% if models[model_id].empty() %}
          Action graph is empty
        {% else %}

          <div class="row">
            <div class="col-sm-6">
              Genes: {{ models[model_id].genes()|length }}<br>
              Modifications: {{ models[model_id].modifications()|length }}<br>
              Bindings: {{ models[model_id].bindings()|length }}<br>
            </div>

            <div class="col-sm-6">
              <div class="action-graph-view">
                <a type="button" class="btn btn-default btn-md panel-button nugget-list-view"><span class="glyphicon glyphicon-resize-small"></span> Interaction network</a>
                <a type="button" class="btn btn-default btn-md panel-button nugget-table-view active"><span class="glyphicon glyphicon-resize-full"></span> Action graph</a>
              </div>
            </div>
          </div>


          <div id="progressBlock">
            <div id="progressBarMessage">Loading action graph...</div>
            <div id="progressBarBlock">
              <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
          </div>
          <svg id="actionGraphSvg" width="1000" height="600" style="display: none;"></svg>

          <div class="row">
            <div class="col-md-10">
            </div>
            <div id="saveLayoutButtonBlock" class="col-md-2" style="text-align: right; display: none;">
              <a id="saveLayoutButton" type="button" class="btn btn-primary btn-md"><span class="glyphicon glyphicon-floppy-disk"></span> Save current layout</a>
            </div>
          </div>

        {% endif %}

      </div>
      <div class="tab-pane" id="nuggets" role="tabpanel">

        {% if models[model_id].empty() %}
            Model does not contain any nuggets
        {% else %}
            <div class="row">
              <div class="col-sm-6">
              </div>
              <div class="col-sm-6">
                <div class="nuggets-view">
                  <a type="button" class="btn btn-default btn-md panel-button nugget-list-view active"><span class="glyphicon glyphicon-list"></span> List view</a>
                  <a type="button" class="btn btn-default btn-md panel-button nugget-table-view" onclick="creatNuggetTable('{{ model_id }}')"><span class="glyphicon glyphicon-equalizer"></span> Table view</a>
                </div>
              </div>
            </div>
            <div id="nuggetsView">
              <div class="table-responsive">
              <table class="table table-striped table-sm">
                <tbody>
                  {% for nugget in models[model_id].nuggets() %}
                  <tr>
                    <td class="nugget-record nugget-id"><a href="{{ url_for('nuggets.nugget_view', model_id=model_id, nugget_id=nugget) }}">{{ nugget }}</a></td>
                    <td class="nugget-record nugget-desc"><p>{{ nugget_desc[nugget] }}</p></td>
                    <td class="nugget-nav-buttons">
                      <a type="button" id="showNuggetButton{{ nugget }}" class="btn btn-primary btn-md panel-button show-nugget-button" onclick="addSvgAndVisualizeNugget(this,  '{{ model_id }}', '{{ nugget }}')"><span class="glyphicon glyphicon-search"></span> Show graph</a>
                      <a type="button" id="hideNuggetButton{{ nugget }}" class="btn btn-primary btn-md panel-button show-nugget-button" onclick="removeNuggetSvg(this, '{{ nugget }}')" style='display: none;'><span class="glyphicon glyphicon-remove"></span> Hide graph</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            </div>

<!--           <ul class="list-group models">
          {% for nugget in models[model_id].nuggets() %}
            <li class="list-group-item nugget-item" id="{{ nugget }}">
              {{ nugget }}
              <span class="nugget-desc"> {{ nugget_desc[nugget] }}</span><span class="nugget-nav-buttons"><a type="button" class="btn btn-primary btn-md panel-button show-nugget-button"><span class="glyphicon glyphicon-search"></span> Show graph</a></span>
          </li>
          {% endfor %}
          </ul> -->
        {% endif %}
      </div>
    </div>



{% endblock %}
{% if models[model_id].empty() %}
{% else %}
{% block custom_scripts %}
  <script type="text/javascript">
    getActionGraphAndVisualize('{{ model_id }}', '{{ url_for('static', filename='js/forceLayoutWorker.js') }}');
  </script>
{% endblock %}
{% endif %}